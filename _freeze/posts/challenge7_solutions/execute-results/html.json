{
  "hash": "a0fa72cfece91bf7db00dfa6f6fb173a",
  "result": {
    "markdown": "---\ntitle: \"Challenge 7 Solutions\"\nauthor: \"Sean Conway\"\ndescription: \"Visualizing Multiple Dimensions\"\ndate: \"1/22/2024\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_7\n  - hotel_bookings\n  - australian_marriage\n  - air_bnb\n  - eggs\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(lubridate)\nlibrary(here)\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Challenge Overview\n\nToday's challenge is to:\n\n1)  read in a data set, and describe the data set using both words and any supporting information (e.g., tables, etc)\n2)  tidy data (as needed, including sanity checks)\n3)  mutate variables as needed (including sanity checks)\n4)  Recreate at least two graphs from previous exercises, but introduce at least one additional dimension that you omitted before using ggplot functionality (color, shape, line, facet, etc) The goal is not to create unneeded [chart ink (Tufte)](https://www.edwardtufte.com/tufte/), but to concisely capture variation in additional dimensions that were collapsed in your earlier 2 or 3 dimensional graphs.\n\n-   Explain why you choose the specific graph type\n\n5)  If you haven't tried in previous weeks, work this week to make your graphs \"publication\" ready with titles, captions, and pretty axis labels and other viewer-friendly features\n\n[R Graph Gallery](https://r-graph-gallery.com/) is a good starting point for thinking about what information is conveyed in standard graph types, and includes example R code. And anyone not familiar with Edward Tufte should check out his [fantastic books](https://www.edwardtufte.com/tufte/books_vdqi) and [courses on data visualizaton.](https://www.edwardtufte.com/tufte/courses)\n\n(be sure to only include the category tags for the data you use!)\n\n## Hotel Bookings\n\n## Read in and clean the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbookings_orig<- here(\"posts\",\"_data\",\"hotel_bookings.csv\") %>%\n  read_csv()\n\nselect(bookings_orig, starts_with(\"arrival\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 119,390 × 4\n   arrival_date_year arrival_date_month arrival_date_week_number\n               <dbl> <chr>                                 <dbl>\n 1              2015 July                                     27\n 2              2015 July                                     27\n 3              2015 July                                     27\n 4              2015 July                                     27\n 5              2015 July                                     27\n 6              2015 July                                     27\n 7              2015 July                                     27\n 8              2015 July                                     27\n 9              2015 July                                     27\n10              2015 July                                     27\n# ℹ 119,380 more rows\n# ℹ 1 more variable: arrival_date_day_of_month <dbl>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbookings<-bookings_orig%>%\n  mutate(date_arrival = str_c(arrival_date_day_of_month,\n                              arrival_date_month,\n                              arrival_date_year, sep=\"/\"),\n         date_arrival = dmy(date_arrival))%>%\n  select(-starts_with(\"arrival\"))\nbookings %>%\n  select(date_arrival)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 119,390 × 1\n   date_arrival\n   <date>      \n 1 2015-07-01  \n 2 2015-07-01  \n 3 2015-07-01  \n 4 2015-07-01  \n 5 2015-07-01  \n 6 2015-07-01  \n 7 2015-07-01  \n 8 2015-07-01  \n 9 2015-07-01  \n10 2015-07-01  \n# ℹ 119,380 more rows\n```\n:::\n:::\n\n\n## Visualization with multiple dimensions\n\nPreviously, we viusalized the variation in number of bookings across time, split by the type of hotel (`City` vs. `Resort`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbookings_month_hotel_n <- bookings %>%\n  mutate(month=floor_date(date_arrival,unit=\"month\")) %>%\n  group_by(month, hotel) %>%\n  summarise(n=n()) %>%\n  ungroup()\nbookings_month_hotel_n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 52 × 3\n   month      hotel            n\n   <date>     <chr>        <int>\n 1 2015-07-01 City Hotel    1398\n 2 2015-07-01 Resort Hotel  1378\n 3 2015-08-01 City Hotel    2480\n 4 2015-08-01 Resort Hotel  1409\n 5 2015-09-01 City Hotel    3529\n 6 2015-09-01 Resort Hotel  1585\n 7 2015-10-01 City Hotel    3386\n 8 2015-10-01 Resort Hotel  1571\n 9 2015-11-01 City Hotel    1235\n10 2015-11-01 Resort Hotel  1105\n# ℹ 42 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbookings_month_hotel_n %>%\n  ggplot(aes(month,n,col=hotel))+\n  geom_line()+\n  scale_x_date(NULL, date_labels = \"%b %y\",breaks=\"2 months\")+\n  scale_y_continuous(limits=c(0,5000))+\n  labs(x=\"date\",y=\"number of bookings\")+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nLet's consider splitting the data based on `meal`, the type of meal booked.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncount(bookings, meal)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  meal          n\n  <chr>     <int>\n1 BB        92310\n2 FB          798\n3 HB        14463\n4 SC        10650\n5 Undefined  1169\n```\n:::\n:::\n\n\nFrom the [data source](https://www.kaggle.com/datasets/jessemostipak/hotel-booking-demand): *Type of meal booked. Categories are presented in standard hospitality meal packages: Undefined/SC – no meal package; BB – Bed & Breakfast; HB – Half board (breakfast and one other meal – usually dinner); FB – Full board (breakfast, lunch and dinner)*\n\nBelow, we recode meal to make the labels more informative, and then use `count()` to compute the number of meal bookings for each hotel across time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbookings_month_hotel_meal_n <- bookings %>%\n  mutate(month=floor_date(date_arrival,unit=\"month\"),\n         meal=recode(meal,\n                     BB=\"Bed and Breakfast\",\n                     FB=\"Full board\",\n                     HB=\"Half board\",\n                     SC=\"Undefined\"),\n         across(c(hotel, meal),as.factor)) %>%\n  group_by(month,hotel,meal) %>%\n  summarise(n=n()) %>%\n  ungroup()\nbookings_month_hotel_meal_n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 190 × 4\n   month      hotel        meal                  n\n   <date>     <fct>        <fct>             <int>\n 1 2015-07-01 City Hotel   Bed and Breakfast  1071\n 2 2015-07-01 City Hotel   Half board          312\n 3 2015-07-01 City Hotel   Undefined            15\n 4 2015-07-01 Resort Hotel Bed and Breakfast   989\n 5 2015-07-01 Resort Hotel Full board           69\n 6 2015-07-01 Resort Hotel Half board          320\n 7 2015-08-01 City Hotel   Bed and Breakfast  1881\n 8 2015-08-01 City Hotel   Half board          507\n 9 2015-08-01 City Hotel   Undefined            92\n10 2015-08-01 Resort Hotel Bed and Breakfast   968\n# ℹ 180 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(bookings_month_hotel_meal_n,aes(month, n, col=meal))+\n  geom_path()+\n  facet_wrap(vars(hotel))+\n  scale_x_date()+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nWe can then make the plot more palatable by modifying the **theme** and **color palette**. Personally, I like using the [ggthemes](https://github.com/jrnold/ggthemes) package to add a custom theme to my plots. I also use the [ggsci](https://cran.r-project.org/web/packages/ggsci/vignettes/ggsci.html) package to add in a custom color palette based on the tv show Futurama. I also add in some different axis labels.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(bookings_month_hotel_meal_n,aes(month, n, col=meal))+\n  geom_line()+\n  facet_wrap(vars(hotel))+\n  # ggsci::scale_color_futurama(name=\"Meal Type\")+\n  see::scale_color_okabeito()+\n  scale_x_date()+\n  labs(x=\"Date\",y=\"Number of Bookings\")+\n  ggthemes::theme_few()+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Australian Marriage\n\nThis is another tabular data source published by the [Australian Bureau of Statistics](https://www.abs.gov.au/) that requires a decent amount of cleaning. In 2017, Australia conducted a postal survey to gauge citizens' opinions towards same sex marriage: \"Should the law be changed to allow same-sex couples to marry?\" All Australian citizens are required to vote in elections, so citizens could respond in one of four ways: vote yes, vote no, vote in an unclear way, or fail to vote. (See the \"Explanatory Notes\" sheet for more details.)\n\nBelow we read in the data, using code previously used in the challenge 3 solution. For an explanation of the code, please see that post.\n\n### Read Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvote_orig <- here(\"posts\",\"_data\",\"australian_marriage_law_postal_survey_2017_-_response_final.xls\") %>%\n  read_excel(sheet=\"Table 2\",\n           skip=7,\n           col_names = c(\"District\", \"Yes\", \"del\", \"No\", rep(\"del\", 6), \"Illegible\", \"del\", \"No Response\", rep(\"del\", 3)))%>%\n  #select(!starts_with(\"del\"))%>%\n  select(-matches(\"del\")) %>%\n  drop_na(District)%>%\n  filter(!str_detect(District, \"(Total)\"))%>%\n  filter(!str_starts(District, \"\\\\(\"))\nvote<- vote_orig%>%\n  mutate(Division = case_when(\n    str_ends(District, \"Divisions\") ~ District,\n    TRUE ~ NA_character_ ))%>%\n  fill(Division, .direction = \"down\") %>%\n  filter(!str_detect(District, \"Division|Australia\"))\n```\n:::\n\n\n### Visualization with Multiple Dimensions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvote %>%\n  mutate(Division=str_remove(Division, \" Divisions\")) %>%\n  pivot_longer(cols=Yes:`No Response`,names_to = \"Response\",values_to = \"Count\") %>%\n  filter(Response!=\"Illegible\") %>%\n  group_by(Division, Response) %>%\n  summarise(Total_Count=sum(Count)) %>%\n  ungroup() %>%\n  mutate(Response=factor(Response,levels=c(\"Yes\",\"No\",\"No Response\"),ordered=T)) %>%\n  ungroup() %>%\n  ggplot(aes(Response,Total_Count,fill=reorder(Division,-Total_Count)))+\n  geom_col(position = \"dodge\")+\n  ggsci::scale_fill_nejm(name=\"Division\")+\n  ggthemes::theme_few()+\n  labs(y=\"Count\")+\n  scale_y_continuous(labels=scales::label_number(suffix=\"K\",scale=1e-4))+\n  theme(axis.text=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Air BnB\n\nThis is a data set from air bnb. Most of this code is exactly as it was in Challenge 5, with the added work being making the plots more palatable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb<-here(\"posts\",\"_data\",\"AB_NYC_2019.csv\") %>%\n  read_csv()\n```\n:::\n\n\n### Univariate Visualizations\n\nFirst, let's take a look at the distribution of prices.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(airb,aes(price))+\n  geom_histogram()\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nWoah, there's clearly a few outliers here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrange(airb$price)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]     0 10000\n```\n:::\n\n```{.r .cell-code}\nairb_filtered <- airb %>%\n  filter(price>0 & price<1500)\nairb_filtered %>%\n  ggplot(aes(price))+\n  geom_histogram()+\n  scale_x_continuous(breaks = seq(0,1500,125))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nThat's better. The prices look right-skewed.\n\n### Bivariate Visualization(s)\n\nLet's consider the different types of rooms and how they relate to price.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(room_type,price))+\n  geom_boxplot()+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(price))+\n  geom_histogram()+\n  facet_wrap(vars(neighbourhood_group),scales=\"free\")\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(room_type,price))+\n  geom_boxplot()+\n  facet_wrap(vars(neighbourhood_group),scales=\"free\")+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nWhat about the relationship between minimum number of nights and price?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(minimum_nights,price))+\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nThere's probably too much variability/not enough data to draw a clear conclusion.\n\nThese AirBnB data are from New York City - so let's take a look at how the borough relates to price.\n\nWe can order the boxplot by descending value of `price`, using the `reorder()` function and the `FUN` argument to specify that we're using *median* price.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(reorder(neighbourhood_group,-price,FUN = median),price))+\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nAgain, a lot of variability and skew in the data, though it makes sense that Manhattan and Brooklyn would cost the most to stay in.\n\nLet's remake that plot, but make it a little prettier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprice_med <- airb_filtered %>%\n  group_by(neighbourhood_group) %>%\n  summarise(median_price=median(price,na.rm=T)) %>%\n  ungroup()\nprice_med\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  neighbourhood_group median_price\n  <chr>                      <dbl>\n1 Bronx                         65\n2 Brooklyn                      90\n3 Manhattan                    150\n4 Queens                        75\n5 Staten Island                 75\n```\n:::\n\n```{.r .cell-code}\nairb_filtered %>%\n  ggplot(aes(reorder(neighbourhood_group,-price,FUN = median),price))+\n  geom_boxplot(alpha=.6)+\n  scale_y_continuous(labels=scales::label_dollar())+\n  labs(x=\"Borough\",\n       y=\"Price\")+\n  ggthemes::theme_few()\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nLet's compute some summary statistics and plot them. We'll compute the median (due to the skew in the data) and make bar graphs. Of course, the boxplot computes the median too, but it will be a bit easier to see when we take out the individual outliers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  rename(borough=neighbourhood_group) %>%\n  group_by(borough) %>%\n  summarise(median_price=median(price)) %>%\n  ungroup() %>%\n  ggplot(aes(reorder(borough,-median_price), median_price))+\n  geom_col()+\n  labs(x=\"borough\")\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nThat's better. Manhattan is a lot more expensive than the other boroughs - about double that of the Bronx!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairb_filtered %>%\n  rename(borough=neighbourhood_group) %>%\n  count(room_type,borough) %>%\n  group_by(borough) %>%\n  mutate(perc=(n/sum(n))*100) %>%\n  arrange(borough) %>%\n  ggplot(aes(room_type,perc))+\n  geom_col()+\n  ggthemes::theme_few()+\n  facet_wrap(vars(borough),scales=\"free_x\")+\n  labs(x=\"Room Type\",y=\"Percent\")+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n## Eggs\n\n\n::: {.cell}\n\n```{.r .cell-code}\neggs <- read_csv(here(\"posts\",\"_data\",\"eggs_tidy.csv\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\neggs_clean <- eggs %>%\n  pivot_longer(cols=3:6,\n               values_to = \"price\") %>%\n  mutate(name=str_replace(name,\"extra_large\",\"extra large\"),\n         name=str_replace(name,\"half_dozen\",\"half dozen\")) %>%\n  separate(name,into=c(\"size\",\"amount\"),sep=\"_\") %>%\n  mutate(date = str_c(month, year, sep=\" \"),\n         date = my(date))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(eggs_clean,aes(date,price,col=amount))+\n  geom_point(alpha=.5)+\n  scale_x_date()+\n  scale_y_continuous(labels=scales::label_dollar(),limits=c(0,300))+\n  facet_wrap(vars(size))+\n  ggsci::scale_color_d3()+\n  labs(x=\"Date\",y=\"Avg. Price Per Carton\")+\n  ggthemes::theme_few()+\n  theme(axis.text.x=element_text(angle=90))\n```\n\n::: {.cell-output-display}\n![](challenge7_solutions_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "challenge7_solutions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}